<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>jquery实现多级树形分类可折叠菜单特效代码</title>
    <!--图标样式-->
    <link rel="stylesheet" type="text/css" href="{{static_url('css/bootstrap.min.css')}}"/>
    <!--主要样式-->
    <link rel="stylesheet" type="text/css" href="{{static_url('css/style.css')}}"/>
    <link rel="stylesheet" type="text/css" href="{{static_url('css/main.css')}}"/>
    <script type="text/javascript" src="{{static_url('js/jquery-1.7.2.min.js')}}"></script>
    <script type="text/javascript">
        $(function () {
            $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Collapse this branch');
            $('.tree li.parent_li > span').on('click', function (e) {
                var children = $(this).parent('li.parent_li').find(' > ul > li');
                if (children.is(":visible")) {
                    children.hide('fast');
                    $(this).attr('title', 'Expand this branch').find(' > i').addClass('glyphicons glyphicons-plus').removeClass('glyphicons glyphicons-minus');
                } else {
                    children.show('fast');
                    $(this).attr('title', 'Collapse this branch').find(' > i').addClass('glyphicons glyphicons-minus').removeClass('glyphicons glyphicons-plus');
                }
                e.stopPropagation();
            });
        });
    </script>
</head>

<body>

<div class="jumbotron jumbotron-small">
    <h1>目录查询系统</h1>
    <form class="form-inline search-bar">
        <input type="search" class="form-control" size="50" placeholder="需要搜索的内容…">
        <button type="button" class="btn btn-info">搜索</button>
    </form>
</div>

<div class="tree">
    <ul id="fileTree">

    </ul>

</div>

<script>

    function getJsonLength(jsonData) {
        var jsonLength = 0;
        for (var item in jsonData) {
            jsonLength++;
        }
        return jsonLength;
    }

    function requestDiskInfo() {
        var x = new XMLHttpRequest();
        x.onreadystatechange = function () {
            if (x.readyState === 4 && x.status === 200) {
                var disk_info = eval("(" + x.responseText + ")");
                for (var i = 0; i < getJsonLength(disk_info); i++) {
                    console.log(disk_info[i].Caption);
                    $("#fileTree").append("<li>" +
                        "<a class='dir-file' title='" + disk_info[i].Caption + "'>" +
                        "<span>" +
                        "<i class=\"icon-folder-open\"></i>"
                        + disk_info[i].Caption +
                        "</span>" +
                        "</a>" +
                        "</li>")
                }
                $('.dir-file').click(function () {
                        getChildren($(this).parent(), $(this).attr("title"));
                    }
                )
            }
        };
        x.open("GET", "?param=disk_info", true);
        x.send();
    }

    function getChildren(l, p) {
        console.log(p);
        var li_parent = l;
        var path = p;
        if (li_parent.children().length > 1) {
            return;
        }
        var x = new XMLHttpRequest();
        x.onreadystatechange = function () {
            if (x.readyState === 4 && x.status === 200) {
                var dir_info = eval("(" + x.responseText + ")");
                li_parent.append("<ul class='ul-open'>");
                var ul_parent = li_parent.children("ul");
                console.log("got response");
                for (var i = 0; i < getJsonLength(dir_info); i++) {
                    if (dir_info[0].fileType === "dir") {
                        ul_parent.append("<li>" +
                            "<a class='dir-file' title='" + path + "\\" + dir_info[i].fileName + "'>" +
                            "<span>" +
                            "<i class=\"icon-folder-open\"></i>"
                            + dir_info[i].fileName +
                            "</span>" +
                            "</a>" +
                            "</li>"
                        );
                    } else {
                        ul_parent.append("<li>" +
                            "<a title='" + path + "\\" + dir_info[i].fileName + "'>" +
                            "<span>" +
                            "<i class=\"icon-folder-open\"></i>" +
                            dir_info[i].fileName +
                            "</span>" +
                            "</a>" +
                            "</li>"
                        );
                    }
                    //console.log(dir_info[i].fileName);
                }
                li_parent.append("</ul>");
                $('.dir-file').click(function () {
                    console.log("set children dir on click");
                    getChildren($(this).parent(), $(this).attr("title"));
                })
            }
        };
        x.open("GET", "?param=dir_info&path=" + path, true);
        x.send();
    }

    $(document).ready(function () {
        requestDiskInfo();
    })
</script>
</body>
</html>